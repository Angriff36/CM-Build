### Iteration 2: Task Management & Real-time

- **Iteration ID:** `I2`
- **Goal:** Implement core task claiming, completion, and real-time sync.
- **Prerequisites:** I1
- **Tasks:**
  - **Task 2.1:**
    - **Task ID:** `I2.T1`
    - **Description:** Generate Sequence Diagram for task claim flow (PlantUML)
    - **Agent Type Hint:** DiagrammingAgent
    - **Inputs:** Task lifecycle
    - **Input Files**: None
    - **Target Files:** docs/diagrams/task_claim_sequence.puml
    - **Deliverables:** PlantUML sequence diagram
    - **Acceptance Criteria:** Diagram accurately depicts flow
    - **Dependencies:** I1.T2
    - **Parallelizable:** Yes
  - **Task 2.2:**
    - **Task ID:** `I2.T2`
    - **Description:** Implement libs/supabase with typed client and RPC helpers.
    - **Agent Type Hint:** BackendAgent
    - **Inputs:** Supabase schema
    - **Input Files:** supabase/migrations/
    - **Target Files:** libs/supabase/src/client.ts, libs/supabase/src/rpc.ts
    - **Deliverables:** Data access layer
    - **Acceptance Criteria:** Queries return typed data
    - **Dependencies:** I1.T5, I1.T6
    - **Parallelizable:** No
  - **Task 2.3:**
    - **Task ID:** `I2.T3`
    - **Description:** Create Supabase RPC for claim_task and complete_task.
    - **Agent Type Hint:** DatabaseAgent
    - **Inputs:** Task model
    - **Input Files:** libs/shared/src/models.ts
    - **Target Files:** supabase/functions/claim_task.sql, supabase/functions/complete_task.sql
    - **Deliverables:** Stored procedures
    - **Acceptance Criteria:** RPCs handle idempotency and audit
    - **Dependencies:** I2.T2
    - **Parallelizable:** Yes
  - **Task 2.4:**
    - **Task ID:** `I2.T4`
    - **Description:** Build apps/prepchef with task list and claim UI.
    - **Agent Type Hint:** FrontendAgent
    - **Inputs:** UI components
    - **Input Files:** libs/ui/src/
    - **Target Files:** apps/prepchef/src/pages/tasks.tsx, apps/prepchef/src/components/TaskList.tsx
    - **Deliverables:** Task dashboard
    - **Acceptance Criteria:** Claims update in real-time
    - **Dependencies:** I2.T2, I1.T7
    - **Parallelizable:** No
  - **Task 2.5:**
    - **Task ID:** `I2.T5`
    - **Description:** Add React Query and Supabase Realtime to prepchef.
    - **Agent Type Hint:** FrontendAgent
    - **Inputs:** Data layer
    - **Input Files:** libs/supabase/src/
    - **Target Files:** apps/prepchef/src/hooks/useTasks.ts
    - **Deliverables:** Real-time hooks
    - **Acceptance Criteria:** State syncs across devices
    - **Dependencies:** I2.T4
    - **Parallelizable:** Yes
  - **Task 2.6:**
    - **Task ID:** `I2.T6`
    - **Description:** Implement undo functionality with tokens.
    - **Agent Type Hint:** BackendAgent
    - **Inputs:** Task RPCs
    - **Input Files:** supabase/functions/
    - **Target Files:** supabase/functions/undo_task.sql
    - **Deliverables:** Undo RPC
    - **Acceptance Criteria:** Tokens expire correctly
    - **Dependencies:** I2.T3
    - **Parallelizable:** Yes
