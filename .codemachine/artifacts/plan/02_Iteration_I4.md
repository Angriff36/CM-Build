### Iteration 4: Admin & Multi-Event Coordination

- **Iteration ID:** `I4`
- **Goal:** Develop admin dashboard, event management, and heuristics.
- **Prerequisites:** I3
- **Tasks:**
  - **Task 4.1:**
    - **Task ID:** `I4.T1`
    - **Description:** Build apps/admin-crm with event and task boards.
    - **Agent Type Hint:** FrontendAgent
    - **Inputs:** UI components
    - **Input Files:** libs/ui/src/
    - **Target Files:** apps/admin-crm/src/pages/events.tsx
    - **Deliverables:** Admin dashboard
    - **Acceptance Criteria:** Assigns tasks via drag
    - **Dependencies:** I2.T4
    - **Parallelizable:** No
  - **Task 4.2:**
    - **Task ID:** `I4.T2`
    - **Description:** Implement task assignment RPC.
    - **Agent Type Hint:** DatabaseAgent
    - **Inputs:** Task model
    - **Input Files:** libs/shared/src/models.ts
    - **Target Files:** supabase/functions/assign_task.sql
    - **Deliverables:** Assignment RPC
    - **Acceptance Criteria:** Updates assigned_user_id
    - **Dependencies:** I2.T3
    - **Parallelizable:** Yes
  - **Task 4.3:**
    - **Task ID:** `I4.T3`
    - **Description:** Add multi-event support with filters.
    - **Agent Type Hint:** FrontendAgent
    - **Inputs:** Event model
    - **Input Files:** libs/shared/src/models.ts
    - **Target Files:** apps/prepchef/src/hooks/useEvents.ts
    - **Deliverables:** Event hooks
    - **Acceptance Criteria:** Filters tasks by event
    - **Dependencies:** I4.T1
    - **Parallelizable:** Yes
  - **Task 4.4:**
    - **Task ID:** `I4.T4`
    - **Description:** Develop task consolidation heuristics.
    - **Agent Type Hint:** BackendAgent
    - **Inputs:** Task data
    - **Input Files:** libs/shared/src/models.ts
    - **Target Files:** supabase/functions/combine_tasks.sql
    - **Deliverables:** Heuristics RPC
    - **Acceptance Criteria:** Suggests valid combinations
    - **Dependencies:** I2.T3
    - **Parallelizable:** Yes
  - **Task 4.5:**
    - **Task ID:** `I4.T5`
    - **Description:** Integrate feature flags for heuristics.
    - **Agent Type Hint:** BackendAgent
    - **Inputs:** Flagsmith
    - **Input Files:** None
    - **Target Files:** libs/shared/src/flags.ts
    - **Deliverables:** Flag helpers
    - **Acceptance Criteria:** Gates combine UI
    - **Dependencies:** I4.T4
    - **Parallelizable:** Yes
  - **Task 4.6:**
    - **Task ID:** `I4.T6`
    - **Description:** Add role-based access controls.
    - **Agent Type Hint:** BackendAgent
    - **Inputs:** User model
    - **Input Files:** libs/shared/src/models.ts
    - **Target Files:** libs/shared/src/access.ts
    - **Deliverables:** RBAC helpers
    - **Acceptance Criteria:** Guards UI actions
    - **Dependencies:** I1.T6
    - **Parallelizable:** Yes
