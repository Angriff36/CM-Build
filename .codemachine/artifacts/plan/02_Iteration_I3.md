<!-- anchor: iteration-3-plan -->

### Iteration 3: Task Management & Heuristics

- **Iteration ID:** `I3`
- **Goal:** Implement full task lifecycle including consolidation heuristics and multi-event support.
- **Prerequisites:** I2
- **Tasks:**
  - **Task 3.1:**
    - **Task ID:** `I3.T1`
    - **Description:** Implement task combination logic in libs/shared with fuzzy matching and unit conversion.
    - **Agent Type Hint:** BackendAgent
    - **Inputs:** Task Consolidation requirements
    - **Input Files:** []
    - **Target Files:** libs/shared/src/heuristics.ts
    - **Deliverables:** Heuristic functions for task similarity.
    - **Acceptance Criteria:** Functions detect similar tasks and propose combinations.
    - **Dependencies:** []
    - **Parallelizable:** Yes
  - **Task 3.2:**
    - **Task ID:** `I3.T2`
    - **Description:** Add combined_task_groups table and RPC for task merging.
    - **Agent Type Hint:** DatabaseAgent
    - **Inputs:** Data Model Overview
    - **Input Files:** []
    - **Target Files:** supabase/migrations/20251211000001_combined_tasks.sql
    - **Deliverables:** Migration and RPC for combine operations.
    - **Acceptance Criteria:** RPC merges tasks and logs audit.
    - **Dependencies:** [I3.T1]
    - **Parallelizable:** No
  - **Task 3.3:**
    - **Task ID:** `I3.T3`
    - **Description:** Create API endpoint for task combination suggestions.
    - **Agent Type Hint:** BackendAgent
    - **Inputs:** API Contract Style
    - **Input Files:** []
    - **Target Files:** apps/prepchef/app/api/tasks/suggestions/route.ts
    - **Deliverables:** Endpoint returning combine proposals.
    - **Acceptance Criteria:** Endpoint uses heuristics and returns suggestions.
    - **Dependencies:** [I3.T2]
    - **Parallelizable:** No
  - **Task 3.4:**
    - **Task ID:** `I3.T4`
    - **Description:** Add combine UI to task dashboard with approval prompts.
    - **Agent Type Hint:** FrontendAgent
    - **Inputs:** UI requirements
    - **Input Files:** libs/ui/src/components/
    - **Target Files:** apps/prepchef/components/CombinePrompt.tsx
    - **Deliverables:** Combine suggestion UI.
    - **Acceptance Criteria:** UI shows suggestions and handles approvals.
    - **Dependencies:** [I3.T3]
    - **Parallelizable:** Yes
  - **Task 3.5:**
    - **Task ID:** `I3.T5`
    - **Description:** Implement multi-event support in task queries and filters.
    - **Agent Type Hint:** BackendAgent
    - **Inputs:** Multi-Event Coordination
    - **Input Files:** []
    - **Target Files:** libs/supabase/src/queries/tasks.ts
    - **Deliverables:** Queries supporting event filtering.
    - **Acceptance Criteria:** Tasks filter by event correctly.
    - **Dependencies:** []
    - **Parallelizable:** Yes
  - **Task 3.6:**
    - **Task ID:** `I3.T6`
    - **Description:** Add role-based access controls to task operations.
    - **Agent Type Hint:** BackendAgent
    - **Inputs:** Permissions/Roles
    - **Input Files:** []
    - **Target Files:** libs/shared/src/access.ts
    - **Deliverables:** RBAC utilities.
    - **Acceptance Criteria:** Operations check roles appropriately.
    - **Dependencies:** []
    - **Parallelizable:** Yes
