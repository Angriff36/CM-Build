# Project Plan: CaterKing Kitchen Management Platform

**Version:** 1.0
**Date:** 2025-12-11
**Generated By:** ProjectPlanner_v2.0

## 1. Project Overview

- **Goal:** Build a unified kitchen management platform that transforms chaotic, multi-event food preparation into an organized, real-time workflow with task consolidation, recipe management, and multi-platform support.
- **High-Level Requirements Summary:**
  - Real-time task dashboard with claim/complete/assign functionality
  - Task consolidation and standardization using heuristic matching
  - Multi-event coordination with cross-event aggregation
  - Recipe and methods knowledge base with media support
  - Role-based permissions (Staff, Manager, Event Lead, Owner)
  - Mobile-first PWA, web admin dashboard, and wall-mounted display
  - Multi-tenant architecture with strict data isolation
- **Key Assumptions:**
  - Single-location kitchen operations (Tier 1 scalability)
  - Online-only application with fail-closed behavior during connectivity loss
  - Supabase as managed backend service for database, auth, storage, and realtime
  - Vercel hosting for Next.js applications
  - Doppler for secrets management
  - pnpm 8+ and Turbo 2+ for monorepo management

## 2. Core Architecture

- **Architectural Style:** Modular monolithic Turbo repo with Next.js applications and shared libraries, leveraging Supabase-managed backend services
- **Technology Stack:**
  - Frontend: Next.js 15 (App Router, React 18 Server Components), Tailwind CSS, ShadCN UI, React Query
  - Backend: Next.js API routes (Edge/Node runtimes), Supabase SQL/RPC, Supabase Edge Functions
  - Database: Supabase Postgres with JSONB columns and Row-Level Security
  - Messaging/Queues: Supabase Realtime channels with company-scoped naming
  - Deployment: Vercel for frontend/API, Supabase for DB/Auth/Storage/Realtime
  - Other Key Libraries/Tools: Doppler (secrets), Flagsmith (feature flags), OpenTelemetry (observability)
- **Key Components/Services:**
  - **apps/prepchef:** Mobile-first staff PWA for task execution and recipe reference
  - **apps/caterking:** Lightweight operations app for smaller teams
  - **apps/admin-crm:** Desktop admin dashboard for managers and owners
  - **apps/display:** Passive wall-mounted display for real-time status monitoring
  - **libs/ui:** Shared design system with ShadCN/Tailwind components
  - **libs/shared:** Domain models, Zod validators, cross-app utilities
  - **libs/supabase:** Typed Supabase client wrappers and RLS-safe operations
  - **Supabase Services:** Postgres database, Auth, Storage, Realtime, Edge Functions
- **Data Model Overview:** Multi-tenant schema with company_id scoping on all tables, including Companies, Users, Events, Tasks, Recipes, Media, and supporting entities for task combinations, audit logs, and presence tracking.
- **API Contract Style:** RESTful JSON APIs exposed through Next.js route handlers, described via OpenAPI definitions, with all mutations calling Supabase RPCs
- **Communication Patterns:** Synchronous task operations flow through Next.js API routes to Supabase RPCs, with Supabase Realtime broadcasting changes to all connected clients via company-scoped channels

## 2.1. Key Architectural Artifacts Planned

- **Component Diagram (PlantUML):** To visualize major service interactions between Next.js apps, shared libraries, and Supabase services (Created in I1.T2)
- **Container Diagram (PlantUML):** To show application boundaries and data flow between frontend apps, API routes, and backend services (Created in I1.T3)
- **Database ERD (PlantUML):** To illustrate multi-tenant schema with company_id isolation and relationships between core entities (Created in I1.T4)
- **Context Diagram (PlantUML):** To show system boundaries and external integrations with users and services (Created in I1.T5)
- **OpenAPI Specification (YAML):** To define REST API contracts for tasks, events, recipes, and users (Created in I2.T1)
- **Sequence Diagrams (PlantUML):** To document critical user flows like task claiming, recipe viewing, and manager assignments (Created in I2.T2)
- **Deployment Diagram (PlantUML):** To illustrate Vercel hosting, Supabase services, and CI/CD pipeline (Created in I3.T1)

## 3. Directory Structure

- **Root Directory:** `caterking/`
- **Structure Definition:**
  ```
  caterking/
  ├── apps/
  │   ├── prepchef/           # Mobile staff PWA
  │   │   ├── app/
  │   │   │   ├── (auth)/
  │   │   │   ├── tasks/
  │   │   │   ├── recipes/
  │   │   │   └── layout.tsx
  │   │   ├── components/
  │   │   └── package.json
  │   ├── caterking/         # Lightweight ops app
  │   ├── admin-crm/         # Admin dashboard
  │   └── display/           # Wall-mounted display
  ├── libs/
  │   ├── ui/                # Shared design system
  │   │   ├── src/
  │   │   │   ├── components/
  │   │   │   ├── tokens/
  │   │   │   └── index.ts
  │   │   └── package.json
  │   ├── shared/            # Domain models and utilities
  │   │   ├── src/
  │   │   │   ├── models/
  │   │   │   ├── validators/
  │   │   │   └── hooks/
  │   │   └── package.json
  │   ├── supabase/          # Database client and helpers
  │   │   ├── src/
  │   │   │   ├── client.ts
  │   │   │   ├── rpc/
  │   │   │   └── types.ts
  │   │   └── package.json
  │   ├── rag/               # Document ingestion (Python)
  │   └── mcp/               # MCP integrations
  ├── supabase/
  │   ├── migrations/
  │   ├── functions/
  │   ├── seed/
  │   └── tests/
  ├── docs/
  │   ├── diagrams/         # UML diagrams (PlantUML source files)
  │   ├── adr/              # Architectural Decision Records
  │   └── api/              # OpenAPI specifications
  ├── api/
  │   └── openapi/          # API specification files
  ├── tests/
  │   ├── e2e/
  │   ├── integration/
  │   └── unit/
  ├── .github/
  │   └── workflows/
  ├── package.json
  ├── pnpm-workspace.yaml
  ├── turbo.json
  └── README.md
  ```

## 4. DIRECTIVES & STRICT PROCESS

#### **Command Usage Constraints**

Do NOT use exploratory or planning commands or use listing commands (`ls`, `la`, `ll`, `dir`) except:

1. When explicitly instructed by your protocol
2. Before escalating critical errors for diagnostic information

**Rationale:** Minimize unnecessary output and token consumption. Focus on execution, not exploration.

**1. Internal Content Blueprint:** Before generating any output, your first step **MUST** be to create a silent, internal plan. Mentally calculate the target line counts for each section based on the project scale and content distribution percentages. This blueprint is for your internal reasoning only and **MUST NOT** be included in the final output.

**2. In-Memory Content Buffering:** You **MUST** generate the complete and final content for the entire file in a single, continuous thought process. As you generate content for each section according to your blueprint, you will hold it all in an internal memory buffer. You are forbidden from starting any file-writing command until the content for the _entire file_ is finalized in this buffer.

**3. Single Atomic Write Operation:** Once the buffer contains the complete file content, you **MUST** write it to the specified path in a **single, atomic command**. This command must create or overwrite the file (`>`).

**4. Final Verification and Targeted Correction:** Immediately after the single write operation, you **MUST** perform one final, rapid verification.
_ **A. Fast Check:** Verify the file's line count and file existence using a **single, one-line Python command**
_ **B. Targeted Append:** If and only if the line count is below the required minimum, you will append the necessary lines by adding relevant, contextual detail

## 5. Iteration Plan

- **Total Iterations Planned:** 5
- **Iteration Dependencies:** I1 (Foundation) → I2 (Core Features) → I3 (Admin & Display) → I4 (Enhancements) → I5 (Polish & Optimization)

---

### Iteration 1: Foundation & Core Infrastructure

- **Iteration ID:** `I1`
- **Goal:** Establish the foundational architecture, database schema, shared libraries, and basic application structure
- **Prerequisites:** None
- **Tasks:**
  - **Task 1.1:**
    - **Task ID:** `I1.T1`
    - **Description:** Initialize Turbo monorepo structure with pnpm workspace and configure shared libraries
    - **Agent Type Hint:** `SetupAgent`
    - **Inputs:** Project requirements, Turbo monorepo guidelines
    - **Input Files**: `package.json`, `pnpm-workspace.yaml`, `turbo.json`
    - **Target Files:** `package.json`, `pnpm-workspace.yaml`, `turbo.json`, `libs/ui/package.json`, `libs/shared/package.json`, `libs/supabase/package.json`
    - **Deliverables:** Configured monorepo with shared library packages, build scripts, and development tooling
    - **Acceptance Criteria:** Turbo build succeeds for all packages, shared libraries can be imported via path aliases
    - **Dependencies:** None
    - **Parallelizable:** No
  - **Task 1.2:**
    - **Task ID:** `I1.T2`
    - **Description:** Create Supabase database schema with multi-tenant tables and RLS policies
    - **Agent Type Hint:** `DatabaseAgent`
    - **Inputs:** Database design requirements, multi-tenant architecture specifications
    - **Input Files**: `supabase/migrations/` directory
    - **Target Files:** `supabase/migrations/0001_base_schema.sql`, `supabase/migrations/0002_rls_policies.sql`
    - **Deliverables:** Complete database schema with companies, users, events, tasks, recipes tables and RLS policies
    - **Acceptance Criteria:** All tables created with company_id scoping, RLS policies enforce tenant isolation, Supabase types generated
    - **Dependencies:** `I1.T1`
    - **Parallelizable:** No
  - **Task 1.3:**
    - **Task ID:** `I1.T3`
    - **Description:** Generate PlantUML Component Diagram showing system architecture
    - **Agent Type Hint:** `DocumentationAgent`
    - **Inputs:** Architecture specifications, component relationships
    - **Input Files**: Project requirements document
    - **Target Files:** `docs/diagrams/component_overview.puml`
    - **Deliverables:** PlantUML component diagram file
    - **Acceptance Criteria:** Diagram renders correctly showing all major components and their relationships
    - **Dependencies:** `I1.T2`
    - **Parallelizable:** Yes
  - **Task 1.4:**
    - **Task ID:** `I1.T4`
    - **Description:** Create PlantUML ERD diagram for database schema
    - **Agent Type Hint:** `DocumentationAgent`
    - **Inputs:** Database schema, table relationships
    - **Input Files**: `supabase/migrations/0001_base_schema.sql`
    - **Target Files:** `docs/diagrams/supabase_erd.mmd`
    - **Deliverables:** PlantUML ERD diagram file
    - **Acceptance Criteria:** Diagram accurately represents all tables, relationships, and constraints
    - **Dependencies:** `I1.T2`
    - **Parallelizable:** Yes
  - **Task 1.5:**
    - **Task ID:** `I1.T5`
    - **Description:** Generate PlantUML Context Diagram showing system boundaries
    - **Agent Type Hint:** `DocumentationAgent`
    - **Inputs:** System context, external integrations
    - **Input Files**: Project requirements document
    - **Target Files:** `docs/diagrams/deployment_view.puml`
    - **Deliverables:** PlantUML context diagram file
    - **Acceptance Criteria:** Diagram shows system boundaries, users, and external services
    - **Dependencies:** `I1.T2`
    - **Parallelizable:** Yes
  - **Task 1.6:**
    - **Task ID:** `I1.T6`
    - **Description:** Set up shared UI library with design system tokens and base components
    - **Agent Type Hint:** `FrontendAgent`
    - **Inputs:** UI design specifications, component requirements
    - **Input Files**: `libs/ui/` directory structure
    - **Target Files:** `libs/ui/src/tokens/index.ts`, `libs/ui/src/components/Button.tsx`, `libs/ui/src/index.ts`
    - **Deliverables:** Design system tokens, base UI components, library exports
    - **Acceptance Criteria:** Components can be imported and used in applications, design tokens are consistent
    - **Dependencies:** `I1.T1`
    - **Parallelizable:** Yes
  - **Task 1.7:**
    - **Task ID:** `I1.T7`
    - **Description:** Create shared domain models and validators
    - **Agent Type Hint:** `BackendAgent`
    - **Inputs:** Data model specifications, validation requirements
    - **Input Files**: `libs/shared/` directory structure
    - **Target Files:** `libs/shared/src/models/index.ts`, `libs/shared/src/validators/index.ts`, `libs/shared/src/index.ts`
    - **Deliverables:** TypeScript domain models, Zod validators, shared utilities
    - **Acceptance Criteria:** Models match database schema, validators enforce data integrity
    - **Dependencies:** `I1.T2`
    - **Parallelizable:** Yes
  - **Task 1.8:**
    - **Task ID:** `I1.T8`
    - **Description:** Configure Supabase client library with typed queries and RPC helpers
    - **Agent Type Hint:** `BackendAgent`
    - **Inputs:** Supabase configuration, database schema
    - **Input Files**: `libs/supabase/` directory structure
    - **Target Files:** `libs/supabase/src/client.ts`, `libs/supabase/src/rpc/index.ts`, `libs/supabase/src/types.ts`
    - **Deliverables:** Typed Supabase client, RPC wrappers, generated types
    - **Acceptance Criteria:** Client can connect to Supabase, types match schema, RPC functions are callable
    - **Dependencies:** `I1.T2`
    - **Parallelizable:** Yes

---

### Iteration 2: Core Task Management & Real-time Features

- **Iteration ID:** `I2`
- **Goal:** Implement core task management functionality, real-time updates, and basic user interfaces
- **Prerequisites:** `I1`
- **Tasks:**
  - **Task 2.1:**
    - **Task ID:** `I2.T1`
    - **Description:** Create OpenAPI specification for task management APIs
    - **Agent Type Hint:** `DocumentationAgent`
    - **Inputs:** API requirements, data models
    - **Input Files**: `libs/shared/src/models/index.ts`
    - **Target Files:** `api/openapi/tasks.yaml`, `docs/api/tasks.md`
    - **Deliverables:** Complete OpenAPI specification for task CRUD operations
    - **Acceptance Criteria:** Specification validates against OpenAPI 3.0, includes all required endpoints
    - **Dependencies:** `I1.T7`
    - **Parallelizable:** Yes
  - **Task 2.2:**
    - **Task ID:** `I2.T2`
    - **Description:** Implement Next.js API routes for task management
    - **Agent Type Hint:** `BackendAgent`
    - **Inputs:** OpenAPI specification, RPC functions
    - **Input Files**: `api/openapi/tasks.yaml`
    - **Target Files:** `apps/prepchef/app/api/tasks/route.ts`, `apps/prepchef/app/api/tasks/[id]/claim/route.ts`, `apps/prepchef/app/api/tasks/[id]/complete/route.ts`
    - **Deliverables:** REST API endpoints for task operations
    - **Acceptance Criteria:** All endpoints respond correctly, integrate with Supabase RPC, handle errors appropriately
    - **Dependencies:** `I1.T8`, `I2.T1`
    - **Parallelizable:** No
  - **Task 2.3:**
    - **Task ID:** `I2.T3`
    - **Description:** Create task list UI components for PrepChef app
    - **Agent Type Hint:** `FrontendAgent`
    - **Inputs:** UI design specifications, task data models
    - **Input Files**: `libs/ui/src/components/`, `libs/shared/src/models/`
    - **Target Files:** `apps/prepchef/components/TaskList.tsx`, `apps/prepchef/components/TaskRow.tsx`, `apps/prepchef/components/StatusButton.tsx`
    - **Deliverables:** React components for task display and interaction
    - **Acceptance Criteria:** Components render task data correctly, handle user interactions, are responsive
    - **Dependencies:** `I1.T6`, `I1.T7`
    - **Parallelizable:** Yes
  - **Task 2.4:**
    - **Task ID:** `I2.T4`
    - **Description:** Implement real-time task updates using Supabase Realtime
    - **Agent Type Hint:** `BackendAgent`
    - **Inputs:** Realtime requirements, Supabase configuration
    - **Input Files**: `libs/supabase/src/client.ts`
    - **Target Files:** `libs/shared/src/hooks/useRealtimeTasks.ts`, `apps/prepchef/app/tasks/page.tsx`
    - **Deliverables:** Real-time subscription hooks and task list integration
    - **Acceptance Criteria:** Task updates appear instantly across all connected clients
    - **Dependencies:** `I1.T8`, `I2.T3`
    - **Parallelizable:** No
  - **Task 2.5:**
    - **Task ID:** `I2.T5`
    - **Description:** Create sequence diagrams for critical user flows
    - **Agent Type Hint:** `DocumentationAgent`
    - **Inputs:** User story requirements, API specifications
    - **Input Files**: Project requirements, API specifications
    - **Target Files:** `docs/diagrams/task_claim_sequence.puml`, `docs/diagrams/recipe_view_sequence.puml`, `docs/diagrams/manager_assign_sequence.puml`
    - **Deliverables:** PlantUML sequence diagrams for key workflows
    - **Acceptance Criteria:** Diagrams accurately represent user interaction flows and system responses
    - **Dependencies:** `I2.T1`, `I2.T2`
    - **Parallelizable:** Yes
  - **Task 2.6:**
    - **Task ID:** `I2.T6`
    - **Description:** Implement task claiming and completion functionality
    - **Agent Type Hint:** `FrontendAgent`
    - **Inputs:** Task components, API endpoints
    - **Input Files**: `apps/prepchef/components/`, API routes
    - **Target Files:** `apps/prepchef/components/ClaimButton.tsx`, `apps/prepchef/components/CompleteButton.tsx`, `apps/prepchef/hooks/useTaskActions.ts`
    - **Deliverables:** Interactive task management UI with optimistic updates
    - **Acceptance Criteria:** Users can claim and complete tasks, UI updates optimistically, changes sync via realtime
    - **Dependencies:** `I2.T2`, `I2.T3`, `I2.T4`
    - **Parallelizable:** No
  - **Task 2.7:**
    - **Task ID:** `I2.T7`
    - **Description:** Add basic authentication and role-based access control
    - **Agent Type Hint:** `BackendAgent`
    - **Inputs:** Supabase Auth configuration, role requirements
    - **Input Files**: Supabase Auth settings
    - **Target Files:** `apps/prepchef/middleware.ts`, `libs/shared/src/access/roles.ts`, `libs/supabase/src/auth.ts`
    - **Deliverables:** Authentication middleware and role-based access controls
    - **Acceptance Criteria:** Users must authenticate to access features, role permissions are enforced
    - **Dependencies:** `I1.T2`, `I1.T8`
    - **Parallelizable:** Yes

---

### Iteration 3: Recipe Management & Admin Dashboard

- **Iteration ID:** `I3`
- **Goal:** Implement recipe and methods knowledge base, admin CRM dashboard, and wall display functionality
- **Prerequisites:** `I2`
- **Tasks:**
  - **Task 3.1:**
    - **Task ID:** `I3.T1`
    - **Description:** Create recipe and methods data models and API endpoints
    - **Agent Type Hint:** `BackendAgent`
    - **Inputs:** Recipe requirements, media upload specifications
    - **Input Files**: Database schema, shared models
    - **Target Files:** `apps/admin-crm/app/api/recipes/route.ts`, `apps/admin-crm/app/api/recipes/[id]/route.ts`, `libs/shared/src/models/recipe.ts`
    - **Deliverables:** Recipe CRUD API endpoints with media support
    - **Acceptance Criteria:** Recipes can be created, updated, retrieved with media attachments
    - **Dependencies:** `I2.T2`
    - **Parallelizable:** Yes
  - **Task 3.2:**
    - **Task ID:** `I3.T2`
    - **Description:** Implement media upload functionality with Supabase Storage
    - **Agent Type Hint:** `BackendAgent`
    - **Inputs:** Media upload requirements, Supabase Storage configuration
    - **Input Files**: Supabase Storage settings
    - **Target Files:** `apps/admin-crm/app/api/media/sign/route.ts`, `libs/supabase/src/storage.ts`
    - **Deliverables:** Signed URL generation and media upload handling
    - **Acceptance Criteria:** Users can upload images and videos, files are stored securely, URLs are generated
    - **Dependencies:** `I1.T8`
    - **Parallelizable:** Yes
  - **Task 3.3:**
    - **Task ID:** `I3.T3`
    - **Description:** Create admin CRM dashboard layout and navigation
    - **Agent Type Hint:** `FrontendAgent`
    - **Inputs:** Admin UI requirements, dashboard specifications
    - **Input Files**: `apps/admin-crm/` directory structure
    - **Target Files:** `apps/admin-crm/app/layout.tsx`, `apps/admin-crm/components/Sidebar.tsx`, `apps/admin-crm/components/Header.tsx`
    - **Deliverables:** Admin dashboard shell with navigation and layout
    - **Acceptance Criteria:** Dashboard renders correctly, navigation works, responsive design implemented
    - **Dependencies:** `I1.T6`
    - **Parallelizable:** Yes
  - **Task 3.4:**
    - **Task ID:** `I3.T4`
    - **Description:** Implement recipe editor and management interface
    - **Agent Type Hint:** `FrontendAgent`
    - **Inputs:** Recipe data models, media upload API
    - **Input Files**: Recipe API endpoints, UI components
    - **Target Files:** `apps/admin-crm/app/recipes/page.tsx`, `apps/admin-crm/components/RecipeEditor.tsx`, `apps/admin-crm/components/MediaUploader.tsx`
    - **Deliverables:** Recipe creation and editing interface
    - **Acceptance Criteria:** Admins can create, edit, and manage recipes with media attachments
    - **Dependencies:** `I3.T1`, `I3.T2`, `I3.T3`
    - **Parallelizable:** No
  - **Task 3.5:**
    - **Task ID:** `I3.T5`
    - **Description:** Create wall-mounted display application
    - **Agent Type Hint:** `FrontendAgent`
    - **Inputs:** Display requirements, real-time data needs
    - **Input Files**: `apps/display/` directory structure
    - **Target Files:** `apps/display/app/layout.tsx`, `apps/display/components/StatusBoard.tsx`, `apps/display/components/UrgentTicker.tsx`
    - **Deliverables:** Passive display interface for wall-mounted screens
    - **Acceptance Criteria:** Display shows real-time task status, updates automatically, optimized for distance viewing
    - **Dependencies:** `I2.T4`, `I1.T6`
    - **Parallelizable:** Yes
  - **Task 3.6:**
    - **Task ID:** `I3.T6`
    - **Description:** Generate deployment diagram and documentation
    - **Agent Type Hint:** `DocumentationAgent`
    - **Inputs:** Infrastructure requirements, deployment strategy
    - **Input Files**: Project architecture, hosting specifications
    - **Target Files:** `docs/diagrams/deployment_diagram.puml`, `docs/operations/deployment_guide.md`
    - **Deliverables:** Deployment architecture diagram and operational documentation
    - **Acceptance Criteria:** Diagram shows complete deployment architecture, documentation is comprehensive
    - **Dependencies:** `I1.T5`
    - **Parallelizable:** Yes

---

### Iteration 4: Task Consolidation & Advanced Features

- **Iteration ID:** `I4`
- **Goal:** Implement task consolidation heuristics, advanced filtering, and enhanced user experience
- **Prerequisites:** `I3`
- **Tasks:**
  - **Task 4.1:**
    - **Task ID:** `I4.T1`
    - **Description:** Implement task similarity heuristic matching engine
    - **Agent Type Hint:** `BackendAgent`
    - **Inputs:** Heuristic requirements, task consolidation specifications
    - **Input Files**: Task data models, similarity algorithms
    - **Target Files:** `supabase/functions/task_heuristics/index.ts`, `libs/shared/src/heuristics/taskMatcher.ts`
    - **Deliverables:** Heuristic engine for detecting similar tasks
    - **Acceptance Criteria:** Engine identifies similar tasks based on ingredients, units, and methods with configurable thresholds
    - **Dependencies:** `I2.T2`
    - **Parallelizable:** Yes
  - **Task 4.2:**
    - **Task ID:** `I4.T2`
    - **Description:** Create task combination suggestion UI
    - **Agent Type Hint:** `FrontendAgent`
    - **Inputs:** Heuristic engine results, UI requirements
    - **Input Files**: Heuristic engine API, UI components
    - **Target Files:** `apps/prepchef/components/CombineSuggestions.tsx`, `apps/prepchef/components/SuggestionCard.tsx`
    - **Deliverables:** UI for displaying and acting on task combination suggestions
    - **Acceptance Criteria:** Users can view suggested combinations, accept or reject suggestions, see breakdown of combined tasks
    - **Dependencies:** `I4.T1`, `I2.T3`
    - **Parallelizable:** No
  - **Task 4.3:**
    - **Task ID:** `I4.T3`
    - **Description:** Implement advanced filtering and search functionality
    - **Agent Type Hint:** `FrontendAgent`
    - **Inputs:** Filtering requirements, task data
    - **Input Files**: Task components, data models
    - **Target Files:** `apps/prepchef/components/FilterPanel.tsx`, `apps/prepchef/components/SearchBar.tsx`, `libs/shared/src/hooks/useTaskFilters.ts`
    - **Deliverables:** Advanced filtering system with multiple criteria
    - **Acceptance Criteria:** Users can filter by event, station, status, user, priority; search functionality works across task attributes
    - **Dependencies:** `I2.T3`
    - **Parallelizable:** Yes
  - **Task 4.4:**
    - **Task ID:** `I4.T4`
    - **Description:** Add undo functionality for task operations
    - **Agent Type Hint:** `BackendAgent`
    - **Inputs:** Undo requirements, task state management
    - **Input Files**: Task API endpoints, state models
    - **Target Files:** `apps/prepchef/app/api/tasks/[id]/undo/route.ts`, `libs/shared/src/undo/undoManager.ts`, `apps/prepchef/components/UndoToast.tsx`
    - **Deliverables:** Undo system with token-based reversal
    - **Acceptance Criteria:** Users can undo claim/complete operations within time window, state is properly restored
    - **Dependencies:** `I2.T2`, `I2.T6`
    - **Parallelizable:** Yes
  - **Task 4.5:**
    - **Task ID:** `I4.T5`
    - **Description:** Implement presence tracking and device health monitoring
    - **Agent Type Hint:** `BackendAgent`
    - **Inputs:** Presence requirements, device monitoring needs
    - **Input Files**: Realtime configuration, user models
    - **Target Files:** `libs/shared/src/presence/presenceTracker.ts`, `supabase/functions/presence_heartbeat/index.ts`
    - **Deliverables:** Presence tracking system for devices and users
    - **Acceptance Criteria:** Device presence is tracked, offline devices are detected, health metrics are collected
    - **Dependencies:** `I2.T4`
    - **Parallelizable:** Yes

---

### Iteration 5: Polish, Testing & Optimization

- **Iteration ID:** `I5`
- **Goal:** Complete testing suite, optimize performance, implement final UI polish, and prepare for production deployment
- **Prerequisites:** `I4`
- **Tasks:**
  - **Task 5.1:**
    - **Task ID:** `I5.T1`
    - **Description:** Implement comprehensive testing suite
    - **Agent Type Hint:** `TestingAgent`
    - **Inputs:** Application features, testing requirements
    - **Input Files**: All application code
    - **Target Files:** `tests/e2e/task-management.spec.ts`, `tests/integration/realtime.spec.ts`, `tests/unit/taskModels.test.ts`
    - **Deliverables:** Complete test coverage for all major features
    - **Acceptance Criteria:** Unit tests cover domain logic, integration tests cover API endpoints, E2E tests cover critical user journeys
    - **Dependencies:** All previous tasks
    - **Parallelizable:** Yes
  - **Task 5.2:**
    - **Task ID:** `I5.T2`
    - **Description:** Optimize performance and implement caching strategies
    - **Agent Type Hint:** `PerformanceAgent`
    - **Inputs:** Performance requirements, application metrics
    - **Input Files**: React Query configuration, API routes
    - **Target Files:** `libs/shared/src/cache/cacheConfig.ts`, `apps/prepchef/app/cache.tsx`, performance monitoring setup
    - **Deliverables:** Optimized application with effective caching
    - **Acceptance Criteria:** Page load times under 3 seconds, API responses under 200ms, effective cache invalidation
    - **Dependencies:** `I5.T1`
    - **Parallelizable:** Yes
  - **Task 5.3:**
    - **Task ID:** `I5.T3`
    - **Description:** Implement final UI polish and accessibility improvements
    - **Agent Type Hint:** `FrontendAgent`
    - **Inputs:** UI requirements, accessibility guidelines
    - **Input Files**: All UI components
    - **Target Files:** Updated UI components with polish, accessibility improvements, responsive design fixes
    - **Deliverables:** Polished user interface with full accessibility support
    - **Acceptance Criteria:** WCAG 2.1 AA compliance, responsive design works across all devices, micro-interactions are smooth
    - **Dependencies:** `I5.T2`
    - **Parallelizable:** Yes
  - **Task 5.4:**
    - **Task ID:** `I5.T4`
    - **Description:** Set up production deployment pipeline and monitoring
    - **Agent Type Hint:** `DevOpsAgent`
    - **Inputs:** Deployment requirements, monitoring needs
    - **Input Files**: Application code, infrastructure configuration
    - **Target Files:** `.github/workflows/deploy.yml`, monitoring dashboard configuration, production environment setup
    - **Deliverables:** Production-ready deployment pipeline with monitoring
    - **Acceptance Criteria:** Automated deployment to Vercel, monitoring alerts configured, rollback procedures documented
    - **Dependencies:** `I5.T3`
    - **Parallelizable:** Yes
  - **Task 5.5:**
    - **Task ID:** `I5.T5`
    - **Description:** Create final documentation and user guides
    - **Agent Type Hint:** `DocumentationAgent`
    - **Inputs:** Complete application features, user requirements
    - **Input Files**: All application code and documentation
    - **Target Files:** `README.md`, `docs/user-guide.md`, `docs/admin-guide.md`, `docs/api/README.md`
    - **Deliverables:** Comprehensive documentation for users and developers
    - **Acceptance Criteria:** Documentation covers all features, API reference is complete, user guides are clear and helpful
    - **Dependencies:** `I5.T4`
    - **Parallelizable:** Yes

---

## 6. Verification and Integration Strategy

- **Testing Levels:**
  - Unit tests for domain models, validators, and utility functions (Vitest)
  - Integration tests for API endpoints and database operations (Supabase test environment)
  - E2E tests for critical user journeys (Playwright)
  - Visual regression tests for UI components (Storybook/Chromatic)
- **CI/CD:**
  - GitHub Actions workflow running lint, typecheck, and tests on all PRs
  - Automated deployment to staging environment after merge to main
  - Production deployment requires manual approval with feature flag validation
  - Rollback procedures with Vercel deployments and Supabase PITR
- **Code Quality Gates:**
  - ESLint and Prettier configuration with custom rules for the monorepo
  - TypeScript strict mode with no implicit any types
  - Minimum 80% test coverage for shared libraries
  - Storybook accessibility tests (axe) must pass for all UI components
- **Artifact Validation:**
  - PlantUML diagrams must render without syntax errors
  - OpenAPI specifications must validate against OpenAPI 3.0 schema
  - Database migrations must include both forward and rollback scripts
  - Generated TypeScript types must be kept in sync with database schema

## 7. Glossary

- **PWA:** Progressive Web App - A web application that can be installed on mobile devices and works offline
- **RLS:** Row-Level Security - PostgreSQL feature for enforcing data access rules at the database row level
- **RPC:** Remote Procedure Call - A function call that executes on the database server
- **JWT:** JSON Web Token - A compact, URL-safe means of representing claims to be transferred between parties
- **Supabase:** Open-source Firebase alternative providing database, auth, storage, and realtime services
- **Turbo:** Monorepo build system for JavaScript/TypeScript projects
- **pnpm:** Package manager for JavaScript with efficient dependency handling
- **Next.js:** React framework for building server-side rendered and static web applications
- **React Query:** Library for managing server state in React applications
- **Tailwind CSS:** Utility-first CSS framework for rapid UI development
- **ShadCN UI:** Collection of reusable UI components built with Radix UI and Tailwind CSS
- **Vercel:** Platform for deploying frontend applications with edge computing capabilities
- **Doppler:** Secrets management platform for secure configuration handling
- **Flagsmith:** Feature flag management platform for controlled feature rollouts
- **OpenTelemetry:** Observability framework for generating and collecting telemetry data
- **PlantUML:** Tool for generating UML diagrams from text-based descriptions
- **OpenAPI:** Specification for defining RESTful APIs
- **Zod:** TypeScript-first schema declaration and validation library
- **Playwright:** End-to-end testing framework for web applications
- **Vitest:** Fast unit testing framework with TypeScript support
- **Storybook:** Development environment for UI components in isolation
- **Chromatic:** Visual testing platform for Storybook components
- **JSONB:** JSON binary data type in PostgreSQL for storing structured data
- **Edge Functions:** Serverless functions that run at the network edge for low latency
- **Realtime:** WebSocket-based communication for instant data synchronization
