# Project Plan: CaterKing Kitchen Management Platform

**Version:** 1.0
**Date:** 2025-12-11
**Generated By:** opencode

## 1. Project Overview

- **Goal:** Deliver a unified, real-time kitchen management platform that streamlines task execution, reduces duplicated work, and ensures consistent recipe adherence across multi-tenant commercial kitchens.

- **High-Level Requirements Summary:** Real-time task dashboard for staff claiming/completing tasks; task consolidation via heuristics; recipe and method knowledge base with media; multi-event coordination; role-based permissions with RLS; mobile PWA, web admin, and kiosk display; unit conversions and audit logging.

- **Key Assumptions:** Tech stack as specified (Next.js + Supabase); multi-tenant with company_id scoping; real-time via Supabase Realtime; heuristics deterministic and flag-gated; offline not supported; media uploads via signed URLs.

## 2. Core Architecture

- **Architectural Style:** Modular monolithic Turbo repo with Next.js App Router, Supabase backend, and shared libraries for domain logic.

- **Technology Stack:**
  - Frontend: Next.js 15 (App Router, React 18 Server Components), Tailwind + ShadCN via @caterkingapp/ui, React Query, Supabase Realtime.
  - Backend: Next.js API routes, Supabase Postgres with RLS, Supabase Edge Functions for heuristics.
  - Database: Supabase Postgres with JSONB for recipes.
  - Messaging/Queues: Supabase Realtime channels.
  - Deployment: Vercel for apps, Supabase for DB/Auth/Storage.
  - Other Key Libraries/Tools: Flagsmith for feature flags, Doppler for secrets, OpenTelemetry for observability.

- **Key Components/Services:** apps/prepchef (staff PWA), apps/caterking (light ops), apps/admin-crm (manager/admin), apps/display (kiosk), libs/ui (design system), libs/shared (domain models), libs/supabase (data access), supabase/sql (RPCs).

- **Data Model Overview:** Companies, Users, Events, Tasks, Recipes, Media, Audit Logs, etc., all scoped by company_id.

- **API Contract Style:** REST-ish with Next.js routes, OpenAPI specs.

- **Communication Patterns:** Server components fetch initial data, React Query handles mutations, Supabase Realtime syncs state.

## 2.1. Key Architectural Artifacts Planned

- Component Diagram (PlantUML) - To visualize app and lib interactions (Created in I1.T2)
- ERD (PlantUML) - To show database schema (Created in I1.T3)
- Sequence Diagrams (PlantUML) - For key flows like task claim (Created in I2.T1)
- OpenAPI Spec (YAML) - For API contracts (Created in I3.T1)
- Data Schemas (JSON Schema) - For recipe JSONB (Created in I3.T2)

## 3. Directory Structure

- **Root Directory:** `caterking/`
- **Structure Definition:**

```
caterking/
├── apps/
│   ├── prepchef/
│   ├── caterking/
│   ├── admin-crm/
│   └── display/
├── libs/
│   ├── ui/
│   ├── shared/
│   ├── supabase/
│   ├── rag/
│   └── mcp/
├── supabase/
│   ├── migrations/
│   ├── functions/
│   └── seed/
├── docs/
│   ├── diagrams/
│   └── adr/
├── tests/
├── scripts/
└── package.json
```
