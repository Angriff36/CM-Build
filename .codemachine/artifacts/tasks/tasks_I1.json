[
  {
    "task_id": "I1.T1",
    "iteration_id": "I1",
    "iteration_goal": "Stand up the Turbo workspace, shared tooling, baseline Supabase schema, architecture diagrams, and guardrail documentation so subsequent agents can build features without reworking foundations.",
    "description": "Initialize the Turbo repo with pnpm workspace, base package.json, lint/test scripts, and placeholder app/lib folders so future iterations can plug features into a consistent structure.",
    "agent_type_hint": "SetupAgent",
    "inputs": "Blueprint directives for repo structure and tooling conventions.",
    "target_files": [
      "package.json",
      "pnpm-workspace.yaml",
      "turbo.json",
      "apps/prepchef/README.md",
      "libs/shared/package.json"
    ],
    "input_files": ["docs/architecture/01_Blueprint_Foundation.md"],
    "deliverables": "- Workspace skeleton with pnpm scripts for build/lint/test/format plus handy `pnpm dev:<app>` aliases.\n        - Turbo pipeline definitions covering lint, test, build placeholders per package group and referencing caches/outputs.\n        - Placeholder README inside each `apps/*` folder explaining intended purpose, entry command, and guardrails for imports.\n        - Root README callout summarizing Node version, pnpm version pin, Flagsmith placeholder config, and Doppler note.",
    "acceptance_criteria": "pnpm install succeeds; `turbo run lint --dry` executes across placeholder packages; README documents instructions for running turborepo caching; repo root matches directory tree from Section 3 without stray files.",
    "dependencies": [],
    "parallelizable": false,
    "done": true
  },
  {
    "task_id": "I1.T2",
    "iteration_id": "I1",
    "iteration_goal": "Stand up the Turbo workspace, shared tooling, baseline Supabase schema, architecture diagrams, and guardrail documentation so subsequent agents can build features without reworking foundations.",
    "description": "Author contributor docs detailing coding standards, alias usage, ShadCN integration process, feature flag conventions, and Git/GitHub workflows so autonomous agents share a playbook.",
    "agent_type_hint": "DocumentationAgent",
    "inputs": "Repo skeleton plus blueprint directives.",
    "target_files": [
      "CONTRIBUTING.md",
      "docs/operations/engineering_playbook.md",
      "docs/operations/feature_flag_runbook.md"
    ],
    "input_files": ["docs/architecture/01_Blueprint_Foundation.md", "README.md"],
    "deliverables": "- CONTRIBUTING guide with pnpm/turbo commands, branch naming, code review expectations, ADR process, and testing gates.\n        - Engineering playbook capturing alias usage, test coverage minimums, undo/audit requirements, environment setup, and layout of shared libraries.\n        - Feature flag runbook describing Flagsmith environments, toggle lifecycle, exposure logging expectations, and rollback etiquette.\n        - Checklist template for autonomous agents to self-verify compliance before closing tasks.",
    "acceptance_criteria": "Documents reference blueprint anchors, contain task checklists, and highlight automation to be built later; lint passes on Markdown (heading order, anchors) and links resolve to existing sections; GitHub templates updated if needed.",
    "dependencies": ["I1.T1"],
    "parallelizable": true,
    "done": true
  },
  {
    "task_id": "I1.T3",
    "iteration_id": "I1",
    "iteration_goal": "Stand up the Turbo workspace, shared tooling, baseline Supabase schema, architecture diagrams, and guardrail documentation so subsequent agents can build features without reworking foundations.",
    "description": "Produce the PrepChef component diagram showing server/client components, React Query caches, realtime adapter, mutation service, and undo controller interactions referencing Section 2.",
    "agent_type_hint": "DiagrammingAgent",
    "inputs": "Blueprint component descriptions and UI architecture notes.",
    "target_files": ["docs/diagrams/prepchef_components.puml", "docs/diagrams/diagram_index.md"],
    "input_files": [
      "docs/architecture/01_Blueprint_Foundation.md",
      "docs/architecture/06_UI_UX_Architecture.md"
    ],
    "deliverables": "- PlantUML diagram file linking to PlantUML server or local render instructions plus metadata comments for maintainers.\n        - Diagram index entry describing intent, dependencies, upcoming refinement tasks, and ADR references.\n        - README snippet explaining how to regenerate PNG/SVG for design reviews and how to keep ASCII-safe labels.",
    "acceptance_criteria": "Diagram renders without syntax errors, includes every component mentioned in Section 2, uses ASCII-friendly labels, and cross-links to upcoming iteration tasks that rely on it; index table references iteration IDs.",
    "dependencies": ["I1.T1", "I1.T2"],
    "parallelizable": true,
    "done": true
  },
  {
    "task_id": "I1.T4",
    "iteration_id": "I1",
    "iteration_goal": "Stand up the Turbo workspace, shared tooling, baseline Supabase schema, architecture diagrams, and guardrail documentation so subsequent agents can build features without reworking foundations.",
    "description": "Define initial Supabase schema migrations covering Companies, Users, Events, Tasks, CombinedTaskGroups, Stations, StaffSchedules, NotificationPreferences, and DisplaySnapshots, plus generate ERD diagram per Section 2.1.",
    "agent_type_hint": "DatabaseAgent",
    "inputs": "Data model overview, blueprint ERD requirements, and tenancy constraints.",
    "target_files": [
      "supabase/migrations/0001_base_schema.sql",
      "docs/diagrams/supabase_erd.mmd",
      "supabase/seed/base_seed.sql"
    ],
    "input_files": [
      "docs/architecture/01_Blueprint_Foundation.md",
      "supabase/migrations/README.md"
    ],
    "deliverables": "- SQL migration with tables, enums, indexes, and RLS placeholders disabled by default awaiting Task I1.T5.\n        - Mermaid ERD source depicting relationships, undo tokens, audit references, JSONB fields, and station mapping.\n        - Seed script populating demo companies/events/tasks for local dev plus instructions for `supabase db reset` and data anonymization.",
    "acceptance_criteria": "`supabase db lint` passes; ERD renders; seeds load via `supabase db reset`; JSONB columns and indexes align with Section 2 data model; comments reference blueprint anchors and iteration numbers.",
    "dependencies": ["I1.T1"],
    "parallelizable": false,
    "done": true
  },
  {
    "task_id": "I1.T5",
    "iteration_id": "I1",
    "iteration_goal": "Stand up the Turbo workspace, shared tooling, baseline Supabase schema, architecture diagrams, and guardrail documentation so subsequent agents can build features without reworking foundations.",
    "description": "Implement baseline RLS policies, pgTAP tests, and the RLS policy catalog document describing actor/role contexts, impersonation scripts, and audit coverage expectations.",
    "agent_type_hint": "SecurityAgent",
    "inputs": "Base schema, blueprint RLS directives.",
    "target_files": [
      "supabase/migrations/0002_rls_policies.sql",
      "supabase/tests/rls_policies.sql",
      "docs/security/rls_policies.md",
      "scripts/impersonate.ps1"
    ],
    "input_files": [
      "docs/architecture/01_Blueprint_Foundation.md",
      "supabase/migrations/0001_base_schema.sql"
    ],
    "deliverables": "- SQL migration enabling RLS per table with role-checked policies referencing JWT claims and company scope.\n        - pgTAP suite verifying staff/manager/event lead/owner contexts, undo token protection, and tenant isolation scenarios.\n        - Markdown catalog summarizing each policy, risk category, verification method, and future TODOs for knowledge-base tables.\n        - Script to impersonate roles locally via Supabase CLI for automation, with inline help text and exit codes.",
    "acceptance_criteria": "pgTAP tests run via `supabase test` and pass; documentation references tests and blueprint anchors; impersonation script outputs sample tokens and handles Windows/macOS shells.",
    "dependencies": ["I1.T4"],
    "parallelizable": false,
    "done": true
  },
  {
    "task_id": "I1.T6",
    "iteration_id": "I1",
    "iteration_goal": "Stand up the Turbo workspace, shared tooling, baseline Supabase schema, architecture diagrams, and guardrail documentation so subsequent agents can build features without reworking foundations.",
    "description": "Create environment automation including Doppler templates, Supabase CLI profiles, `supabase/config.toml`, and local dev scripts for running Supabase + Next.js with seeded data.",
    "agent_type_hint": "SetupAgent",
    "inputs": "Repo structure, seeds, and RLS policies.",
    "target_files": [
      ".doppler.yaml",
      "configs/doppler.template.yaml",
      "supabase/config.toml",
      "scripts/dev.ps1",
      "scripts/dev.sh"
    ],
    "input_files": ["docs/operations/engineering_playbook.md", "supabase/seed/base_seed.sql"],
    "deliverables": "- Doppler template listing required secrets, descriptions, environment mapping, and rotation cadence plus README snippet.\n        - Supabase config pointing to local project reference IDs, port overrides, storage buckets, and real-time channel quotas.\n        - Cross-platform dev script starting Supabase, running pnpm dev for apps/prepchef, seeding data, and surfacing cleanup instructions with colored output.\n        - Troubleshooting section appended to playbook covering port conflicts, Docker fallback, and Windows WSL quirks.",
    "acceptance_criteria": "Running `scripts/dev` spins up Supabase + Next.js with seeded data and prints friendly instructions; Doppler template validated via `doppler run --config-template`; docs updated with steps and troubleshooting tips; CI ensures script has executable bit for bash.",
    "dependencies": ["I1.T1", "I1.T4", "I1.T5"],
    "parallelizable": true,
    "done": true
  },
  {
    "task_id": "I1.T7",
    "iteration_id": "I1",
    "iteration_goal": "Stand up the Turbo workspace, shared tooling, baseline Supabase schema, architecture diagrams, and guardrail documentation so subsequent agents can build features without reworking foundations.",
    "description": "Establish baseline CI/CD automation (GitHub Actions) covering lint, typecheck, tests, Supabase migrations dry run, Storybook/Chromatic uploading stub, and OpenTelemetry bootstrap config.",
    "agent_type_hint": "OpsAgent",
    "inputs": "Turborepo scripts, seeds, RLS tests.",
    "target_files": [
      ".github/workflows/ci.yml",
      "docs/operations/ci_cd_overview.md",
      "configs/otel.config.json",
      ".github/workflows/chromatic.yml"
    ],
    "input_files": [
      "turbo.json",
      "supabase/migrations/0002_rls_policies.sql",
      "docs/operations/engineering_playbook.md"
    ],
    "deliverables": "- GitHub Actions workflow chaining pnpm install -> turbo lint/test/build -> supabase db lint -> Storybook build -> Chromatic upload placeholder with matrix for Node versions.\n        - Documentation describing approvals, artifact uploads, Doppler/Flagsmith secrets flow, fallback steps for self-hosted runners, and release gating.\n        - OTEL config file describing service names, resource attributes, default exporters for local dev, and environment variable contract.\n        - Chromatic workflow stub referencing libs/ui stories with TODO marker for authentication token plus README instructions for designers.",
    "acceptance_criteria": "Workflow executes successfully on branch push; docs show sample logs; OTEL config loads without JSON schema errors; Chromatic stub ready for later integration with secrets stored in Doppler; CI badge added to README.",
    "dependencies": ["I1.T1", "I1.T6"],
    "parallelizable": true,
    "done": true
  }
]
