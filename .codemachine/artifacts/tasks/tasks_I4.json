[
  {
    "task_id": "I4.T1",
    "description": "Implement Supabase Edge Function (TypeScript) for task combination heuristics plus pipeline to store suggestions, normalized units, and metadata per Section 2.1 spec.",
    "done": true
  },
  {
    "task_id": "I4.T2",
    "iteration_id": "I4",
    "iteration_goal": "Deliver heuristic-powered task combination, manager approval tools, cross-event dashboards, and enhanced audit/undo policies so the platform scales across multiple simultaneous events without confusion.",
    "description": "Build manager-facing combine review UI (Admin CRM + PrepChef combine drawer) to approve, reject, or rollback suggestions, wiring to feature flag `prep.task-combine.v1`.",
    "agent_type_hint": "FullStackAgent",
    "inputs": "Heuristic spec, UI blueprint, API requirements.",
    "target_files": [
      "apps/prepchef/app/combine/page.tsx",
      "apps/admin-crm/app/tasks/combine/page.tsx",
      "apps/admin-crm/components/combine-review.tsx"
    ],
    "input_files": [
      "docs/specs/task_combination.md",
      "docs/ux/ui_interaction_blueprint.md",
      "apps/prepchef/components/task-list.tsx"
    ],
    "deliverables": "- PrepChef combine view summarizing suggestions with opt-in CTA + breakdown popover.\n        - Admin CRM approval board with filters (event/station/confidence) and audit trail.\n        - Feature flag wiring controlling visibility + telemetry exposures.",
    "acceptance_criteria": "Flag toggles behavior; approvals call combine API; UI shows aggregated instructions + rollback actions; tests cover accept/reject states.",
    "dependencies": ["I4.T1", "I2.T3"],
    "parallelizable": true,
    "done": true
  },
  {
    "task_id": "I4.T3",
    "iteration_id": "I4",
    "iteration_goal": "Deliver heuristic-powered task combination, manager approval tools, cross-event dashboards, and enhanced audit/undo policies so the platform scales across multiple simultaneous events without confusion.",
    "description": "Update OpenAPI spec + API routes for combine endpoints, manager assignment board, and `/api/display/summary`, ensuring schema_version increments documented.",
    "agent_type_hint": "BackendAgent",
    "inputs": "Existing spec, new features.",
    "target_files": [
      "api/openapi.yaml",
      "tests/contract/tasks.contract.test.ts",
      "apps/display/app/api/summary/route.ts"
    ],
    "input_files": ["api/openapi.yaml", "apps/prepchef/app/api/tasks/suggestions/route.ts"],
    "deliverables": "- Updated OpenAPI sections for combine approval, rollback, summary endpoints.\n        - Contract tests covering new responses.\n        - Display summary API route returning aggregated view with caching hints.",
    "acceptance_criteria": "Spectral lint passes; contract tests updated; API docs mention feature flags + schema_version.",
    "dependencies": ["I4.T2"],
    "parallelizable": true,
    "done": true
  },
  {
    "task_id": "I4.T4",
    "iteration_id": "I4",
    "iteration_goal": "Deliver heuristic-powered task combination, manager approval tools, cross-event dashboards, and enhanced audit/undo policies so the platform scales across multiple simultaneous events without confusion.",
    "description": "Implement Admin CRM task board with drag-and-drop assignment, staffing sidebar, multi-event filters, realtime updates, and audit logging.",
    "agent_type_hint": "FrontendAgent",
    "inputs": "Task data, UI blueprint, realtime adapter.",
    "target_files": [
      "apps/admin-crm/app/tasks/page.tsx",
      "apps/admin-crm/components/task-board.tsx",
      "libs/shared/src/hooks/useAssignments.ts"
    ],
    "input_files": [
      "apps/admin-crm/app/recipes/page.tsx",
      "libs/shared/src/hooks/useTasks.ts",
      "docs/architecture/06_UI_UX_Architecture.md"
    ],
    "deliverables": "- Multi-column board grouped by station/status with drag handles.\n        - Sidebar showing staff presence + shift schedule alignment.\n        - Hook calling assignment API + updating audit logs + realtime events.\n        - Accessibility support for keyboard-based reassignments.",
    "acceptance_criteria": "Drag/drop updates PrepChef in <1s; board handles >100 tasks via virtualization; Playwright spec ensures assignments + undo function.",
    "dependencies": ["I2.T6", "I2.T7"],
    "parallelizable": true,
    "done": true
  },
  {
    "task_id": "I4.T5",
    "iteration_id": "I4",
    "iteration_goal": "Deliver heuristic-powered task combination, manager approval tools, cross-event dashboards, and enhanced audit/undo policies so the platform scales across multiple simultaneous events without confusion.",
    "description": "Enhance Display app with event/station summary cards, urgent queue ticker, and fallback snapshot polling referencing `/api/display/summary`.",
    "agent_type_hint": "FrontendAgent",
    "inputs": "Summary API, display requirements.",
    "target_files": [
      "apps/display/app/page.tsx",
      "apps/display/components/summary-grid.tsx",
      "apps/display/components/urgent-ticker.tsx",
      "apps/display/hooks/useDisplayData.ts"
    ],
    "input_files": [
      "apps/display/app/page.tsx",
      "docs/architecture/06_UI_UX_Architecture.md",
      "api/openapi.yaml"
    ],
    "deliverables": "- Summary grid showing available/claimed/completed by event/station with timers.\n        - Urgent ticker cycling high-priority tasks with audible cues.\n        - Hook blending realtime + polling fallback + offline banner.\n        - Config knob for rotation cadence stored in Doppler.",
    "acceptance_criteria": "Display handles realtime disconnect gracefully; data matches summary API; ticker accessible; config documented.",
    "dependencies": ["I4.T3"],
    "parallelizable": true,
    "done": true
  },
  {
    "task_id": "I4.T6",
    "iteration_id": "I4",
    "iteration_goal": "Deliver heuristic-powered task combination, manager approval tools, cross-event dashboards, and enhanced audit/undo policies so the platform scales across multiple simultaneous events without confusion.",
    "description": "Expand audit log + undo infrastructure to capture combine approvals, rollbacks, board reassignments, and display snapshots; add CLI/report summarizing critical events.",
    "agent_type_hint": "SecurityAgent",
    "inputs": "Audit schema, new workflows.",
    "target_files": [
      "supabase/functions/log_combination.sql",
      "libs/shared/src/audit/events.ts",
      "scripts/audit/report.ts",
      "docs/operations/audit_runbook.md"
    ],
    "input_files": [
      "docs/security/rls_policies.md",
      "supabase/functions/claim_task.sql",
      "docs/specs/task_combination.md"
    ],
    "deliverables": "- SQL function logging combination + rollback diffs.\n        - Shared audit event constants consumed by UI for linking to logs.\n        - CLI script generating reports for last 24h actions.\n        - Runbook describing access, retention, and export process.",
    "acceptance_criteria": "Audit entries appear for all key actions; CLI prints table; docs cite compliance requirements; undo tokens reference audit IDs.",
    "dependencies": ["I4.T1", "I4.T2"],
    "parallelizable": true,
    "done": true
  },
  {
    "task_id": "I4.T7",
    "iteration_id": "I4",
    "iteration_goal": "Deliver heuristic-powered task combination, manager approval tools, cross-event dashboards, and enhanced audit/undo policies so the platform scales across multiple simultaneous events without confusion.",
    "description": "Performance-test heuristics + admin board under load (simulate 200 tasks, 5 events) using k6 or similar, tune indexes/queries, and record findings.",
    "agent_type_hint": "PerformanceAgent",
    "inputs": "Heuristic function, board UI, summary view.",
    "target_files": [
      "tests/perf/heuristics.k6.js",
      "tests/perf/board.benchmark.md",
      "supabase/migrations/0008_indexes.sql"
    ],
    "input_files": [
      "supabase/functions/task_heuristics/index.ts",
      "apps/admin-crm/components/task-board.tsx",
      "docs/operations/ci_cd_overview.md"
    ],
    "deliverables": "- k6 script simulating heuristics load + API bursts.\n        - Benchmark doc capturing latency, CPU, recommended throttle flags.\n        - Index/SQL tweaks to keep query times <200ms.",
    "acceptance_criteria": "Benchmarks recorded; indexes migrates; doc references instrumentation metrics; gating thresholds added to runbooks.",
    "dependencies": ["I4.T1", "I4.T4"],
    "parallelizable": true,
    "done": false
  },
  {
    "task_id": "I4.T8",
    "iteration_id": "I4",
    "iteration_goal": "Deliver heuristic-powered task combination, manager approval tools, cross-event dashboards, and enhanced audit/undo policies so the platform scales across multiple simultaneous events without confusion.",
    "description": "Update Playwright suites for admin board/combine flows and add chaos tests (simulated realtime drop, conflicting approvals, undo expiration) to guarantee stability.",
    "agent_type_hint": "QATestingAgent",
    "inputs": "New UIs, heuristics, audit logging.",
    "target_files": [
      "tests/playwright/admin.board.spec.ts",
      "tests/playwright/prepchef.combine.spec.ts",
      "tests/playwright/helpers/realtimeChaos.ts"
    ],
    "input_files": [
      "tests/playwright/prepchef.tasks.spec.ts",
      "apps/admin-crm/app/tasks/page.tsx",
      "apps/prepchef/app/combine/page.tsx"
    ],
    "deliverables": "- Admin board spec verifying drag/drop, staff filters, audit log links.\n        - PrepChef combine spec verifying approval, rejection, rollback, offline fallback.\n        - Chaos helper toggling realtime connection to ensure polling fallback tested.",
    "acceptance_criteria": "Tests pass; chaos helper integrated into CI optional job; docs updated.",
    "dependencies": ["I4.T2", "I4.T4", "I4.T5"],
    "parallelizable": true,
    "done": false
  }
]
